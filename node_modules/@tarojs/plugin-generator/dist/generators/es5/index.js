"use strict";
Object.defineProperty(exports, "__esModule", { value: true });
exports.es5Generator = void 0;
/* eslint-disable no-console */
const utils_1 = require("../../utils");
const babel_1 = require("./babel");
const config_1 = require("./config");
async function es5Generator(ctx) {
    const compilerType = (0, utils_1.getCompilerType)(ctx.initialConfig.compiler);
    if (!compilerType) {
        throw new Error('未找到编译器类型');
    }
    await updateBrowserList(ctx);
    await (0, config_1.updateConfig)({ ctx, compilerType });
    await (0, babel_1.updateBabelConfig)(ctx);
    console.log('✅ 启用「编译为 ES5」成功');
}
exports.es5Generator = es5Generator;
async function updateBrowserList(ctx) {
    const { fs } = ctx.helper;
    const browserslistrc = `${ctx.paths.appPath}/.browserslistrc`;
    if (await fs.pathExists(browserslistrc)) {
        await fs.writeFile(browserslistrc, 'last 3 versions\nAndroid >= 4.1\nios >= 8\n', { encoding: 'utf-8', flag: 'w' });
        return;
    }
    const pkgJson = (0, utils_1.readPkgJson)(ctx);
    pkgJson.browserslist = ['last 3 versions', 'Android >= 4.1', 'ios >= 8'];
    await fs.outputJson(`${ctx.paths.appPath}/package.json`, pkgJson, {
        encoding: 'utf-8',
        spaces: 2,
    });
    console.log('✅ 更新 browserslist 成功\n');
}
//# sourceMappingURL=index.js.map