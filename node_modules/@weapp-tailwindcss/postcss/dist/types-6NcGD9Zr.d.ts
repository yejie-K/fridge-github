import { PostCssCalcOptions } from '@weapp-tailwindcss/postcss-calc';
import { AcceptedPlugin, Result as Result$1 } from 'postcss';
import { Result } from 'postcss-load-config';
import { pluginOptions } from 'postcss-preset-env';
import { PxtransformOptions } from 'postcss-pxtransform';
import { UserDefinedOptions } from 'postcss-rem-to-responsive-pixel';

type PipelineStage = 'pre' | 'normal' | 'post';
interface PipelineNodeCursor {
    id: string;
    stage: PipelineStage;
}
interface PipelineNodeContext {
    stage: PipelineStage;
    /**
     * 整个流水线内的顺序索引（从 0 开始）
     */
    index: number;
    /**
     * 当前流水线包含的节点总数
     */
    size: number;
    /**
     * 所在阶段内的顺序索引（从 0 开始）
     */
    stageIndex: number;
    /**
     * 所在阶段的节点数量
     */
    stageSize: number;
    /**
     * 指向前一个节点的游标（若存在）
     */
    previous?: PipelineNodeCursor;
    /**
     * 指向后一个节点的游标（若存在）
     */
    next?: PipelineNodeCursor;
}
interface ResolvedPipelineNode extends PipelineNodeCursor {
    plugin: AcceptedPlugin;
    context: PipelineNodeContext;
}
interface StyleProcessingPipeline {
    nodes: ResolvedPipelineNode[];
    plugins: AcceptedPlugin[];
}
declare function createStylePipeline(options: IStyleHandlerOptions): StyleProcessingPipeline;

declare function createContext(): {
    variablesScopeWeakMap: WeakMap<WeakKey, any>;
    isVariablesScope: (rule: WeakKey) => boolean;
    markVariablesScope: (rule: WeakKey) => void;
};
type IContext = ReturnType<typeof createContext>;

type InjectPreflight = () => IPropValue[];
declare function createInjectPreflight(options?: CssPreflightOptions): InjectPreflight;

type LoadedPostcssOptions = Partial<Omit<Result, 'file'>>;
interface IPropValue {
    prop: string;
    value: string;
}
type CssPreflightOptions = {
    [key: string]: string | number | boolean;
} | false;
type RequiredStyleHandlerOptions = {
    /**
     * @description 默认为 true，此时会对样式主文件，进行猜测
     */
    isMainChunk?: boolean;
    cssPreflight?: CssPreflightOptions;
    cssInjectPreflight?: InjectPreflight;
    escapeMap?: Record<string, string>;
} & Pick<UserDefinedPostcssOptions, 'cssPreflightRange' | 'cssChildCombinatorReplaceValue' | 'injectAdditionalCssVarScope' | 'cssSelectorReplacement' | 'rem2rpx' | 'px2rpx'>;
interface InternalCssSelectorReplacerOptions {
    escapeMap?: Record<string, string>;
}
interface CssCalcOptions extends PostCssCalcOptions {
    includeCustomProperties?: (string | RegExp)[];
}
type IStyleHandlerOptions = {
    ctx?: IContext;
    postcssOptions?: LoadedPostcssOptions;
    cssRemoveProperty?: boolean;
    cssRemoveHoverPseudoClass?: boolean;
    cssPresetEnv?: pluginOptions;
    cssCalc?: boolean | CssCalcOptions | (string | RegExp)[];
    atRules?: {
        property?: boolean;
        supports?: boolean;
        media?: boolean;
    };
    uniAppX?: boolean;
    majorVersion?: number;
} & RequiredStyleHandlerOptions;
interface UserDefinedPostcssOptions {
    cssPreflight?: CssPreflightOptions;
    cssPreflightRange?: 'all';
    cssChildCombinatorReplaceValue?: string | string[];
    cssPresetEnv?: pluginOptions;
    injectAdditionalCssVarScope?: boolean;
    cssSelectorReplacement?: {
        root?: string | string[] | false;
        universal?: string | string[] | false;
    };
    rem2rpx?: boolean | UserDefinedOptions;
    px2rpx?: boolean | PxtransformOptions;
    postcssOptions?: LoadedPostcssOptions;
    cssRemoveHoverPseudoClass?: boolean;
    cssRemoveProperty?: boolean;
    uniAppX?: boolean;
}

interface StyleHandler {
    (rawSource: string, opt?: Partial<IStyleHandlerOptions>): Promise<Result$1>;
    getPipeline: (opt?: Partial<IStyleHandlerOptions>) => StyleProcessingPipeline;
}

export { type CssCalcOptions as C, type IStyleHandlerOptions as I, type LoadedPostcssOptions as L, type PipelineNodeContext as P, type ResolvedPipelineNode as R, type StyleHandler as S, type UserDefinedPostcssOptions as U, type InternalCssSelectorReplacerOptions as a, type PipelineNodeCursor as b, createStylePipeline as c, type PipelineStage as d, type StyleProcessingPipeline as e, createInjectPreflight as f, type IPropValue as g, type CssPreflightOptions as h, type RequiredStyleHandlerOptions as i };
